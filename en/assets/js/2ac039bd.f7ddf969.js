"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9194],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var o=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){if(null==e)return{};var n,o,l=function(e,t){if(null==e)return{};var n,o,l={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var i=o.createContext({}),s=function(e){var t=o.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=s(e.components);return o.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,i=e.parentName,u=g(e,["components","mdxType","originalType","parentName"]),c=s(n),d=l,m=c["".concat(i,".").concat(d)]||c[d]||p[d]||r;return n?o.createElement(m,a(a({ref:t},u),{},{components:n})):o.createElement(m,a({ref:t},u))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,a=new Array(r);a[0]=c;var g={};for(var i in t)hasOwnProperty.call(t,i)&&(g[i]=t[i]);g.originalType=e,g.mdxType="string"==typeof e?e:l,a[1]=g;for(var s=2;s<r;s++)a[s]=n[s];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},7059:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return g},metadata:function(){return s},toc:function(){return p}});var o=n(7462),l=n(3366),r=(n(7294),n(3905)),a=["components"],g={id:"log",title:"Logger",description:"Kratos contains only the simplest Log interface for business-adapted log access. When your business logic needs to use custom logs inside the kratos framework, you only need to implement the Log method simply.",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},i=void 0,s={unversionedId:"component/log",id:"component/log",title:"Logger",description:"Kratos contains only the simplest Log interface for business-adapted log access. When your business logic needs to use custom logs inside the kratos framework, you only need to implement the Log method simply.",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/component/05-log.md",sourceDirName:"component",slug:"/component/log",permalink:"/en/docs/component/log",editUrl:"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/component/05-log.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"log",title:"Logger",description:"Kratos contains only the simplest Log interface for business-adapted log access. When your business logic needs to use custom logs inside the kratos framework, you only need to implement the Log method simply.",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},sidebar:"docs",previous:{title:"Errors",permalink:"/en/docs/component/errors"},next:{title:"Metadata",permalink:"/en/docs/component/metadata"}},u={},p=[{value:"Interface",id:"interface",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Implement logger",id:"implement-logger",level:4},{value:"Implement valuer",id:"implement-valuer",level:4},{value:"Usage",id:"usage",level:3},{value:"Print log with Logger",id:"print-log-with-logger",level:4},{value:"Print log with Helper",id:"print-log-with-helper",level:4},{value:"Add some default fields with Valuer",id:"add-some-default-fields-with-valuer",level:4},{value:"Log to multiple loggers",id:"log-to-multiple-loggers",level:4},{value:"Bind context to logger",id:"bind-context-to-logger",level:4},{value:"Log Filtering",id:"log-filtering",level:4},{value:"Filter by level",id:"filter-by-level",level:5},{value:"Filter by key",id:"filter-by-key",level:5},{value:"Filter by value",id:"filter-by-value",level:5},{value:"Filter with hook function",id:"filter-with-hook-function",level:5},{value:"Print to STDOUT",id:"print-to-stdout",level:4},{value:"Print to fluentd",id:"print-to-fluentd",level:4},{value:"Advanced Usage",id:"advanced-usage",level:3},{value:"Implement Zap Logger",id:"implement-zap-logger",level:4}],c={toc:p};function d(e){var t=e.components,n=(0,l.Z)(e,a);return(0,r.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h3",{id:"interface"},"Interface"),(0,r.kt)("p",null,"Kratos contains only the simplest Log interface for business-adapted log access. When your business logic needs to use custom logs inside the kratos framework, you only need to implement the Log method simply. Kratos logs also provide some log helpful features such as valuer, helper, filter, and so on, which can be implemented directly using the framework's built-in implementations when we need them, or by ourselves."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"type Logger interface {\n    Log(level Level, keyvals ...interface{}) error\n}\n")),(0,r.kt)("h3",{id:"implementation"},"Implementation"),(0,r.kt)("h4",{id:"implement-logger"},"Implement logger"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'// https://github.com/go-kratos/kratos/blob/main/log/std.go\nvar _ Logger = (*stdLogger)(nil)\n\ntype stdLogger struct {\n    log  *log.Logger\n    pool *sync.Pool\n}\n\n// NewStdLogger new a logger with writer.\nfunc NewStdLogger(w io.Writer) Logger {\n    return &stdLogger{\n        log: log.New(w, "", 0),\n        pool: &sync.Pool{\n            New: func() interface{} {\n                return new(bytes.Buffer)\n            },\n        },\n    }\n}\n\n// Log print the kv pairs log.\nfunc (l *stdLogger) Log(level Level, keyvals ...interface{}) error {\n    if len(keyvals) == 0 {\n        return nil\n    }\n    if len(keyvals)%2 != 0 {\n        keyvals = append(keyvals, "")\n    }\n    buf := l.pool.Get().(*bytes.Buffer)\n    buf.WriteString(level.String())\n    for i := 0; i < len(keyvals); i += 2 {\n        fmt.Fprintf(buf, " %s=%v", keyvals[i], keyvals[i+1])\n    }\n    l.log.Output(4, buf.String())~~~~\n    buf.Reset()\n    l.pool.Put(buf)\n    return nil\n}\n')),(0,r.kt)("h4",{id:"implement-valuer"},"Implement valuer"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"func Timestamp(layout string) Valuer {\n    return func(context.Context) interface{} {\n        return time.Now().Format(layout)\n    }\n}\n")),(0,r.kt)("h3",{id:"usage"},"Usage"),(0,r.kt)("h4",{id:"print-log-with-logger"},"Print log with Logger"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'logger := log.DefaultLogger\nlogger.Log(LevelInfo, "key1", "value1")\n')),(0,r.kt)("h4",{id:"print-log-with-helper"},"Print log with Helper"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'log := log.NewHelper(DefaultLogger)\nlog.Debug("test debug")\nlog.Info("test info")\nlog.Warn("test warn")\nlog.Error("test error")\n')),(0,r.kt)("h4",{id:"add-some-default-fields-with-valuer"},"Add some default fields with Valuer"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'logger := DefaultLogger\nlogger = With(logger, "ts", DefaultTimestamp, "caller", DefaultCaller)\nlogger.Log(LevelInfo, "msg", "helloworld")\n')),(0,r.kt)("h4",{id:"log-to-multiple-loggers"},"Log to multiple loggers"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'out := log.NewStdLogger(os.Stdout)\nerr := log.NewStdLogger(os.Stderr)\nl := log.With(MultiLogger(out, err))\nl.Log(LevelInfo, "msg", "test")\n')),(0,r.kt)("h4",{id:"bind-context-to-logger"},"Bind context to logger"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'logger := log.With(NewStdLogger(os.Stdout),\n    "trace", Trace(),\n)\nlog := log.NewHelper(logger)\nctx := context.WithValue(context.Background(), "trace_id", "2233")\nlog.WithContext(ctx).Info("got trace!")\n')),(0,r.kt)("h4",{id:"log-filtering"},"Log Filtering"),(0,r.kt)("p",null,"If you need to filter some fields in the log that should not be printed in plain text, such as password, you can do so by log. NewFilter() implements filtering."),(0,r.kt)("h5",{id:"filter-by-level"},"Filter by level"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'l := log.NewHelper(log.NewFilter(log.DefaultLogger, log.FilterLevel(log.LevelWarn)))\nl.Log(LevelDebug, "msg1", "te1st debug")\nl.Debug("test debug")\nl.Debugf("test %s", "debug")\nl.Debugw("log", "test debug")\nl.Warn("warn log")\n')),(0,r.kt)("h5",{id:"filter-by-key"},"Filter by key"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'l := log.NewHelper(log.NewFilter(log.DefaultLogger, log.FilterKey("password")))\nl.Debugw("password", "123456")\n')),(0,r.kt)("h5",{id:"filter-by-value"},"Filter by value"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'l := log.NewHelper(log.NewFilter(log.DefaultLogger, log.FilterValue("kratos")))\nl.Debugw("name", "kratos")\n')),(0,r.kt)("h5",{id:"filter-with-hook-function"},"Filter with hook function"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'l := log.NewHelper(log.NewFilter(log.DefaultLogger, log.FilterFunc(testFilterFunc)))\nl.Debug("debug level")\nl.Infow("password", "123456")\nfunc testFilterFunc(level Level, keyvals ...interface{}) bool {\n    if level == LevelWarn {\n        return true\n    }\n    for i := 0; i < len(keyvals); i++ {\n        if keyvals[i] == "password" {\n            keyvals[i+1] = "***"\n        }\n    }\n    return false\n}\n')),(0,r.kt)("h4",{id:"print-to-stdout"},"Print to STDOUT"),(0,r.kt)("p",null,"You can create standard output log objects using the StdLogger that comes with it. With the NewHelper log module, Helper generates log modules that provide different levels of log output."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'logger := log.NewStdLogger()\nlog := log.NewHelper(logger)\n// Levels\nlog.Info("some log")\nlog.Infof("format %s", "some log")\nlog.Infow("field_name", "some log")\n')),(0,r.kt)("h4",{id:"print-to-fluentd"},"Print to fluentd"),(0,r.kt)("p",null,"Import fluent sdk"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'import "github.com/go-kratos/kratos/contrib/log/fluent/v2"\n\naddr := "unix:///var/run/fluent/fluent.sock"\nlogger,err := fluent.NewLogger(addr)\nif err != nil {\n    return \n}\nlog := log.NewHelper(logger)\n// Levels\nlog.Info("some log")\nlog.Infof("format %s", "some log")\nlog.Infow("field_name", "some log")\n')),(0,r.kt)("h3",{id:"advanced-usage"},"Advanced Usage"),(0,r.kt)("h4",{id:"implement-zap-logger"},"Implement Zap Logger"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},'var _ log.Logger = (*ZapLogger)(nil)\n\ntype ZapLogger struct {\n    log  *zap.Logger\n    Sync func() error\n}\n\n// NewZapLogger return ZapLogger\nfunc NewZapLogger(encoder zapcore.EncoderConfig, level zap.AtomicLevel, opts ...zap.Option) *ZapLogger {\n    core := zapcore.NewCore(\n        zapcore.NewConsoleEncoder(encoder),\n        zapcore.NewMultiWriteSyncer(\n            zapcore.AddSync(os.Stdout),\n        ), level)\n    zapLogger := zap.New(core, opts...)\n    return &ZapLogger{log: zapLogger, Sync: zapLogger.Sync}\n}\n\n// Log Implementation of logger interface\nfunc (l *ZapLogger) Log(level log.Level, keyvals ...interface{}) error {\n    if len(keyvals) == 0 || len(keyvals)%2 != 0 {\n        l.log.Warn(fmt.Sprint("Keyvalues must appear in pairs: ", keyvals))\n        return nil\n    }\n\n    // Zap.Field is used when keyvals pairs appear\n    var data []zap.Field\n    for i := 0; i < len(keyvals); i += 2 {\n        data = append(data, zap.Any(fmt.Sprint(keyvals[i]), fmt.Sprint(keyvals[i+1])))\n    }\n    switch level {\n    case log.LevelDebug:\n        l.log.Debug("", data...)\n    case log.LevelInfo:\n        l.log.Info("", data...)\n    case log.LevelWarn:\n        l.log.Warn("", data...)\n    case log.LevelError:\n        l.log.Error("", data...)\n    }\n    return nil\n}\n')))}d.isMDXComponent=!0}}]);